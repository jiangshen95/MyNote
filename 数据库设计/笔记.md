# 数据库设计简介
需求分析 => 逻辑设计 => 物理设计 => 维护优化  
***

## 需求分析
实体与实体之间的关系  
实体包含的属性  
属性与属性的组合可以唯一标识一个实体  
永久存储（数据量，是否要分表存储，分库存储）  
归档管理  

## 逻辑设计
1 将需求转化为数据库的逻辑模型  
2 通过ER图的形式对逻辑模型进行展示  
3 同所选用的具体的DBMS系统无关
### 概念
关系：一张表  
元组：表中的一行  
属性：一列 属性名  
候选码：表中的某个属性组，可以唯一确定一个元组  
主码：一个关系有多个候选码，选定其中一个为主码  
域：属性的取值范围  
分量：元组中的一个属性值
### 数据库库设计范式
第一范式，第二范式，第三范式及BC范式，（第四，第五）
#### 操作异常
插入异常：如果某实体随着另一个实体的存在而存在，即缺少某个实体时无法标识这个实体，那么这个表就存在插入异常  
更新异常：如果更改表所对应的某个实体实例的单独属性时，需要将多行更新，那么就说这个表存在更新异常  
删除异常：如果删除表的某一行来反映某实体实例失效时导致另一个不同实体实例信息丢失，那么这个表中就存在删除异常
#### 数据冗余
相同的数据在多个地方存在，或者说表中的某个列可以由其他列计算得到
#### 第一范式(1NF)
数据库表中所有的字段都是单一属性，不可再分的。这个单一属性是由基本的数据类型所构成，如整数、浮点数、字符串等；  
换句话说：第一范式要求数据库中的表都是二维表
#### 第二范式(2NF)
数据库的表中不存在非关键字段对任一候选关键字段的部分函数依赖。  
部分函数依赖是指存在着组合关键字中的某一关键字决定非关键字的情况  
换句话说：所有单关键字段的表都符合第二范式
#### 第三范式(3NF)
第三范式是在第二范式的基础之上定义的  
如果数据表中不存在非关键字段对任意候选关键字段的传递函数依赖则符合第三范式
#### Boyce.Codd范式(BCNF)
在第三范式的基础之上  
数据库表中如果不存在任何字段对任一候选关键字段的传递函数依赖则符合BC范式  
也就是说如果是复合关键字，则复合关键字之间也不能存在函数依赖关系

## 物理设计
>* 选择适合的数据库管理系统
>* 定义数据库、表及字段的命名规范  
>* 根据所选的DBMS系统选择合适的字段类型  
>* 反范式化设计

数据库管理系统 MySQL
___
### 表及字段的命名规则
1. 可读性原则
2. 表意性原则
3. 长名性原则
### 字段类型的选择原则
列的数据类型一方面影响数据存储空间的开销，另一方面也会影响数据查询性能。
* 当一个列可以选择多种数据类型时，应该优先考虑数字类型，其次是日期或者二进制类型，最后是字符类型。
* 对于相同级别的数据类型，应该优先选择占用空间小的数据类型

#### char与varchar如何选择：
1. 如果列中要存储的数据长度差不多是一致的，则应考虑用char；否则应该考虑用varchar
2. 如果列中的最大数据长度小于50Byte，则一般也考虑用char。(如果这个列很少用，则基于节省空间和减少I/O的考虑，还是可以选择用varchar)
3. 一般不宜定义大于50Byte的char类型列
#### decimal与float如何选择
1. decimal用于存储精确数据，而float只能用于存储非精确数据。故精确数据只能选择用decimal类型。
2. 由于float的存储空间开销一般小于decimal，故非精确数据优先选择float类型
#### 时间类型如何存储
1. 使用int或DateTime来存储时间字段
2. 需要存储的时间粒度

### 如何选择主键
1.    区分业务主键和数据库主键  
    业务主键用于标识业务数据，进行表与表之间的关联；  
    数据库主键为了优化数据存储(Innodb会生成6个字节的隐含主键)
2.    根据数据库的类型，考虑主键是否要顺序增长  
3.    主键的字段类型所占空间要尽可能的小
### 避免使用外键约束
1. 降低数据导入的效率
2. 增加维护成本
3. 虽然不建议使用外键约束，但是相关联的列上一定要建立索引
### 避免使用触发器
1. 降低数据导入的效率
2. 可能会出现意想不到的数据异常
3. 使业务逻辑变得复杂
### 关于预留字段
1. 无法准确的知道预留字段的类型
2. 无法准确的知道预留字段中所存储的内容
3. 后期维护预留字段所要的成本，同增加一个字段所需要的成本是相同的。
4. 严禁使用预留字段
### 反范式化
针对范式而言，为了性能和读取效率的考虑而适当的对第三范式的要求进行违反，而允许存在少量的数据冗余  
换句话说，反范式化就是使用空间来换取时间
___
1. 减少表的关联数量
2. 增加数据的读取效率
3. 反范式化一定要适度

## 维护优化
>1. 维护数据字典
>2. 维护索引
>3. 维护表结构
>4. 在适当的时候对表进行水平拆分或垂直拆分
***
### 维护数据字典
1. 使用第三方工具对数据字典进行维护
2. 利用数据库本身的备注字段来维护数据字典。以MySQL为例 COMMENT 字段
### 维护索引
如何选择合适的列建立索引：
1. 出现在WHERE从句，GROUP BY从句，ORDER BY从句中的列
2. 可选择性高的列要放到索引的前面
3. 索引中不要包括太长的数据类型
注意事项：
1. 索引并不是越多越好，过多的索引不但会降低写的效率而且会降低读的效率
2. 定期维护索引碎片
3. 在SQL语句中不要使用强制索引关键字
### 维护表结构
注意事项：
1.   使用在线变更表结构的工具  
    MySQL5.5之前可以使用pt-online-schema-change  
    MySQL5.6之后本身支持在线表结构的变更
2. 同时对数据字典进行维护
3. 控制表的宽度和大小
### 数据库中适合的操作
1. 批量操作 VS 逐条操作
2. 禁止使用Select*这样的查询
3. 控制使用用户自定义函数
4. 不要使用数据库中的全文索引
### 表的垂直拆分
1. 经常一起查询的列放在一起
2. text,blob等大字段拆分出到附加表中
### 表的水平拆分
把一张大表平均的分配到几张小表中。  
使用主键的hash key进行分配